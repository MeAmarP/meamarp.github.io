<head>
  <title>
    {% if page.title == "Home" %}
      {{ site.title }} | {{ site.description }}
    {% else %}
      {{ page.title }} | {{ site.title }}
    {% endif %}
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <link rel="stylesheet" href="{{ site.github.url }}/assets/css/main.css">
  <link rel="stylesheet" href="{{ site.github.url }}/assets/css/syntax.css">
  <!-- Use Atom -->
  {% feed_meta %}
  <!-- Use RSS-2.0 -->
  <!--<link href="{{ site.github.url }}/rss-feed.xml" type="application/rss+xml" rel="alternate" title="{{ site.title }} | {{ site.description }}"/>
  //-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quattrocento+Sans">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <!-- MathJax for LaTeX rendering -->
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
  </script>
  
  <!-- Mermaid for diagram rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    function initMermaid() {
      if (typeof mermaid === 'undefined') {
        console.warn('Mermaid library not loaded');
        return;
      }
      
      mermaid.initialize({ 
        startOnLoad: false, 
        theme: 'default', 
        securityLevel: 'strict',
        logLevel: 'error'
      });
      
      // More comprehensive selectors for Jekyll code blocks
      const selectors = [
        'pre code.language-mermaid',      // Jekyll standard
        'div.language-mermaid',           // Alternative Jekyll format
        'pre.mermaid',                    // Direct pre with mermaid class
        'code.language-mermaid'           // Direct code blocks
      ];
      
      let rendered = 0;
      selectors.forEach(selector => {
        const blocks = document.querySelectorAll(selector);
        blocks.forEach(block => {
          if (block.closest('.mermaid')) return; // Skip if already converted
          
          const text = block.textContent.trim();
          if (!text) return;
          
          const container = document.createElement('div');
          container.className = 'mermaid';
          container.textContent = text;
          
          // Replace the block with container
          if (block.tagName === 'CODE') {
            const pre = block.closest('pre');
            pre ? pre.replaceWith(container) : block.replaceWith(container);
          } else {
            block.replaceWith(container);
          }
          rendered++;
        });
      });
      
      if (rendered > 0) {
        mermaid.run();
      }
    }
    
    // Wait for page to be fully loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMermaid);
    } else {
      initMermaid();
    }
  </script>
  
  <!-- Google Analytics -->
  {% include google-analytics.html %}
  <!-- Use Jekyll SEO plugin -->
  {% seo %}
</head>